<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="__object_factory_8h_source" xml:lang="ru">
<title>ObjectFactory.h</title>
<indexterm><primary>Model/Include/Model/Factory/ObjectFactory.h</primary></indexterm>
<programlisting linenumbering="unnumbered">1 <emphasis role="preprocessor">#pragma&#32;once</emphasis>
2 
3 <emphasis role="preprocessor">#include&#32;&lt;Model/Export.h&gt;</emphasis>
4 
5 <emphasis role="preprocessor">#include&#32;&lt;Model/Factory/AbstractCreator.h&gt;</emphasis>
6 
7 
8 <emphasis role="keyword">namespace&#32;</emphasis>Tetris::Model::Blocks
9 {
13 &#32;&#32;&#32;&#32;<emphasis role="keyword">template</emphasis>&#32;&lt;<emphasis role="keyword">class</emphasis>&#32;Base,&#32;<emphasis role="keyword">class</emphasis>&#32;IdType&gt;
14 &#32;&#32;&#32;&#32;<emphasis role="keyword">class&#32;</emphasis>MODEL_EXPORT&#32;<link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_object_factory">ObjectFactory</link>
15 &#32;&#32;&#32;&#32;{
16 &#32;&#32;&#32;&#32;<emphasis role="keyword">protected</emphasis>:
18 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">using&#32;</emphasis><link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_abstract_creator">AbstractFactory</link>&#32;=&#32;<link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_abstract_creator">AbstractCreator&lt;Base&gt;</link>;
19 
21 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">using&#32;</emphasis><link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_object_factory_1abf8f5e49373221dcd507b8bb41d97700">FactoryMap</link>&#32;=&#32;std::map&lt;IdType,&#32;AbstractFactory*&gt;;
22 
24 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_object_factory_1abf8f5e49373221dcd507b8bb41d97700">FactoryMap</link>&#32;<link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_object_factory_1a8bbf76296d3aa4d85b205fb8adc03525">_factory</link>;
25 
26 &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>:
28 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_object_factory_1a89b66ffc8f9914ebecfd12f1523fcb01">ObjectFactory</link>()&#32;{}
29 
31 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">virtual</emphasis>&#32;<link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_object_factory_1ad8fd77097bd76a268bef6366b8278000">~ObjectFactory</link>()&#32;
32 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
33 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(<emphasis role="keyword">auto</emphasis>&amp;&#32;pair&#32;:&#32;_factory)
34 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
35 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">delete</emphasis>&#32;pair.second;
36 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
37 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
38 
42 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">template</emphasis>&#32;&lt;<emphasis role="keyword">class</emphasis>&#32;C&gt;
43 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_object_factory_1ad5819264d6a5187a94041a5a57aeb937">add</link>(<emphasis role="keyword">const</emphasis>&#32;IdType&amp;&#32;<emphasis role="keywordtype">id</emphasis>)
44 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
45 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;registerClass(<emphasis role="keywordtype">id</emphasis>,&#32;<emphasis role="keyword">new</emphasis>&#32;<link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_creator">Creator&lt;C, Base&gt;</link>());
46 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
47 
48 &#32;&#32;&#32;&#32;<emphasis role="keyword">protected</emphasis>:
52 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_object_factory_1ac4916c7abdc27197364301a62f4d7d43">registerClass</link>(<emphasis role="keyword">const</emphasis>&#32;IdType&amp;&#32;<emphasis role="keywordtype">id</emphasis>,&#32;<link linkend="_class_tetris_1_1_model_1_1_blocks_1_1_abstract_creator">AbstractFactory</link>*&#32;p)
53 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
54 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">typename</emphasis>&#32;FactoryMap::iterator&#32;it&#32;=&#32;_factory.find(<emphasis role="keywordtype">id</emphasis>);
55 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(it&#32;==&#32;_factory.end())
56 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_factory[id]&#32;=&#32;p;
57 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>
58 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">delete</emphasis>&#32;p;
59 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
60 &#32;&#32;&#32;&#32;};
61 }&#32;<emphasis role="comment">//&#32;namespace&#32;Tetris::Model::Blocks</emphasis>
</programlisting></section>
